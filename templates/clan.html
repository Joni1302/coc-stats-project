{% extends "base.html" %}

{% block title %}Clan √úbersicht - Joni's CoC Dashboard{% endblock %}

{% block content %}

    {% if clan %}
    <div class="row mb-4 align-items-center">
        <div class="col-md-9">
            <h1 class="display-4 fw-bold">
                {{ clan.name }} 
                <span class="badge bg-warning text-dark fs-4 align-middle ms-2">Lvl {{ clan.level }}</span>
            </h1>
            <p class="text-muted lead mb-0">Tag: <span class="text-accent">{{ clan.tag }}</span></p>
        </div>
        
        <div class="col-md-3 text-md-end">
            {% if clan.badge_url %}
                <img src="{{ clan.badge_url }}" alt="Clan Wappen" class="img-fluid" style="max-height: 120px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5));">
            {% else %}
                <i class="fa-solid fa-shield-cat text-muted" style="font-size: 3rem;"></i>
            {% endif %}
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-lg-6 mb-4">
            <div class="stats-container h-100">
                <h4 class="text-accent mb-3"><i class="fa-solid fa-scroll me-2"></i>Clan Beschreibung</h4>
                <p class="mb-0" style="white-space: pre-line; color: #ddd;">
                    {{ clan.description | safe }}
                </p>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="row g-3">
                <div class="col-sm-6">
                    <div class="custom-card text-center py-3 mb-0 h-100 flex-column justify-content-center">
                        <div class="icon-box mb-2 me-0"><i class="fa-solid fa-users"></i></div>
                        <h3 class="fw-bold mb-0">{{ clan.members_count }}/50</h3>
                        <small class="text-muted">Mitglieder</small>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="custom-card text-center py-3 mb-0 h-100 flex-column justify-content-center">
                        <div class="icon-box mb-2 me-0"><i class="fa-solid fa-trophy"></i></div>
                        <h3 class="fw-bold mb-0">{{ clan.points }}</h3>
                        <small class="text-muted">Clan Punkte</small>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="custom-card text-center py-3 mb-0 h-100 flex-column justify-content-center">
                        <div class="icon-box mb-2 me-0"><i class="fa-solid fa-lock"></i></div>
                        <h3 class="fw-bold mb-0">{{ clan.required_trophies }}</h3>
                        <small class="text-muted">Ben√∂tigt</small>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="custom-card text-center py-3 mb-0 h-100 flex-column justify-content-center">
                        <div class="icon-box mb-2 me-0"><i class="fa-solid fa-door-open"></i></div>
                        <h5 class="fw-bold mb-0 text-uppercase mt-1">{{ clan.type }}</h5>
                        <small class="text-muted">Status</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <h3 class="border-bottom pb-2 mb-4 border-secondary">Liga & Kriegs-Performance</h3>
    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="stats-container text-center h-100 d-flex flex-column justify-content-center">
                <h5 class="text-muted mb-3">Kriegsliga (CWL)</h5>
                <h4 class="fw-bold text-warning mb-0">{{ clan.war_league }}</h4>
            </div>
        </div>
        
        <div class="col-md-4 mb-3">
            <div class="stats-container text-center h-100 d-flex flex-column justify-content-center">
                <h5 class="text-muted mb-3">Clanstadt Liga</h5>
                <h4 class="fw-bold text-info">{{ clan.capital_league }}</h4>
                <small class="text-muted mt-2">Punkte: {{ clan.capital_points }}</small>
            </div>
        </div>
        
        <div class="col-md-4 mb-3">
            <div class="stats-container h-100">
                <h5 class="text-muted mb-3 text-center">Kriegsstatistik</h5>
                <div class="d-flex justify-content-between border-bottom border-secondary pb-2 mb-2">
                    <span>Siege:</span>
                    <span class="fw-bold text-success">{{ clan.war_wins }}</span>
                </div>
                <div class="d-flex justify-content-between border-bottom border-secondary pb-2 mb-2">
                    <span>Serie:</span>
                    <span class="fw-bold text-warning">{{ clan.war_win_streak }}</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>Log √∂ffentlich:</span>
                    <span class="fw-bold">{{ "Ja" if clan.is_war_log_public else "Nein" }}</span>
                </div>
            </div>
        </div>
    </div>

    {% if cwl.season %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="stats-container p-0 overflow-hidden border-primary" style="border: 1px solid #0d6efd;">
                <div class="p-3 text-center" style="background: linear-gradient(90deg, #0d47a1 0%, #1565c0 100%);">
                    <span class="badge bg-warning text-dark mb-2">CWL Gruppe</span>
                    <h3 class="text-white fw-bold mb-0">Saison {{ cwl.season }}</h3>
                </div>
                
                <div class="p-4">
                    <h5 class="text-muted mb-3 text-center text-uppercase small" style="letter-spacing: 1px;">Gruppe & Gegner</h5>
                    <div class="row g-3 justify-content-center">
                        {% for c in cwl.clans %}
                        <div class="col-6 col-md-3">
                            <div class="p-3 border border-secondary rounded bg-dark text-center h-100 position-relative hover-effect">
                                
                                {% if c.clan_tag == clan.tag %}
                                    <span class="position-absolute top-0 start-50 translate-middle badge bg-success border border-dark">WIR</span>
                                {% endif %}

                                <img src="{{ c.badge_url }}" alt="Badge" class="mb-2" style="width: 50px; height: 50px; object-fit: contain; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));">
                                <h6 class="fw-bold text-white text-truncate mb-1" title="{{ c.clan_name }}">{{ c.clan_name }}</h6>
                                <small class="text-muted">Lvl {{ c.clan_level }}</small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% elif war.state in ['inWar', 'preparation'] %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="stats-container p-0 overflow-hidden position-relative border-danger" style="border-width: 1px; border-style: solid;">
                
                <div class="p-3 text-center position-relative" style="background: linear-gradient(90deg, #b71c1c 0%, #d32f2f 100%);">
                    <span class="badge bg-dark mb-2">Clan Krieg</span>
                    <h3 class="text-white fw-bold mb-0">
                        {% if war.state == 'preparation' %}
                            Vorbereitungstag
                        {% else %}
                            Kampftag l√§uft!
                        {% endif %}
                    </h3>
                    <small class="text-white-50">{{ war.start_time }} - {{ war.end_time }}</small>
                </div>

                <div class="row g-0 align-items-center py-4 px-2">
                    <div class="col-5 text-center">
                        <h4 class="fw-bold text-white mb-1">{{ clan.name }}</h4>
                        <div class="d-flex justify-content-center align-items-center gap-3">
                            <div class="text-warning"><i class="fa-solid fa-star fs-5"></i> <span class="fs-4 fw-bold">{{ war.clan_stars }}</span></div>
                            <div class="text-info"><i class="fa-solid fa-fire fs-5"></i> <span class="fs-4 fw-bold">{{ "%.1f"|format(war.clan_destruction|float) }}%</span></div>
                        </div>
                    </div>
                    <div class="col-2 text-center"><span class="fw-bold fs-2 text-muted fst-italic">VS</span></div>
                    <div class="col-5 text-center">
                        <h4 class="fw-bold text-danger mb-1">{{ war.opponent_name }}</h4>
                        <div class="d-flex justify-content-center align-items-center gap-3">
                            <div class="text-warning"><span class="fs-4 fw-bold">{{ war.opponent_stars }}</span> <i class="fa-solid fa-star fs-5"></i></div>
                            <div class="text-info"><span class="fs-4 fw-bold">{{ "%.1f"|format(war.opponent_destruction|float) }}%</span> <i class="fa-solid fa-fire fs-5"></i></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <h3 class="border-bottom pb-2 mb-4 mt-5 border-secondary">
        <i class="fa-solid fa-list-ol me-2"></i>Mitglieder-Rangliste
    </h3>
    
    <div class="stats-container p-0">
        <div class="table-responsive">
            <table class="table table-dark table-hover align-middle mb-0">
                <thead>
                    <tr class="text-muted text-uppercase small">
                        <th scope="col" class="ps-4">#</th>
                        <th scope="col">Spieler</th>
                        <th scope="col">Rolle</th>
                        <th scope="col" class="text-end pe-4">Troph√§en</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr>
                        <td class="ps-4 text-muted fw-bold" style="width: 50px;">{{ loop.index }}.</td>
                        <td>
                            <div class="fw-bold text-white" style="font-size: 1.1rem;">
                                {% if member.league == 'Legend League' %}
                                    <span class="text-primary me-1">üü£</span>
                                {% else %}
                                    <span class="text-muted me-1">‚ö™</span>
                                {% endif %}
                                {{ member.name }}
                            </div>
                            <small class="text-muted" style="font-size: 0.8rem;">{{ member.tag }}</small>
                        </td>
                        <td>
                            {% if member.role == 'leader' %}
                                <span class="badge bg-danger">Anf√ºhrer</span>
                            {% elif member.role == 'coLeader' or member.role == 'co_leader' %}
                                <span class="badge bg-danger bg-opacity-75">Vize</span>
                            {% elif member.role == 'admin' or member.role == 'elder' %}
                                <span class="badge bg-secondary">√Ñltester</span>
                            {% else %}
                                <span class="text-muted small">Mitglied</span>
                            {% endif %}
                        </td>
                        <td class="text-end pe-4">
                            <span class="badge text-dark fw-bold d-inline-flex align-items-center" 
                                  style="background-color: #f1c40f; font-size: 1rem; min-width: 80px; justify-content: center;">
                                {{ member.trophies }} <i class="fa-solid fa-trophy ms-2"></i>
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    {% else %}
    <div class="alert alert-warning">
        Keine Clan-Daten gefunden. Bitte f√ºhre <code>main.py</code> aus und stelle sicher, dass du in einem Clan bist.
    </div>
    {% endif %}

{% endblock %}